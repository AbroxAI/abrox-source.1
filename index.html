<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üåê Profit Hunters Chat</title>

  <!-- Lucide icons -->
  <script src="https://cdn.jsdelivr.net/npm/lucide@0.276.0/dist/umd/lucide.min.js" defer></script>

  <!-- Theme detection helper -->
  <meta name="color-scheme" content="light dark">

  <!-- Widget CSS -->
  <link rel="stylesheet" href="widget.css">

  <style>
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    .hidden{display:none !important;}
  </style>
</head>
<body>

  <!-- App Header -->
  <header id="tg-header" class="tg-header">
    <div class="tg-header-left">
      <button id="tg-back-btn" class="tg-icon-btn tg-back-btn" aria-label="Back" title="Back">
        <!-- left arrow -->
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
      </button>

      <div class="tg-avatar">
        <img src="assets/group-avatar.jpg" alt="Profit Hunters" />
      </div>

      <div class="tg-meta">
        <div id="tg-title" class="tg-title">üåê Profit Hunters Chat</div>
        <div id="tg-meta-line" class="tg-meta-line">‚Äî members, ‚Äî online</div>
      </div>
    </div>

    <div class="tg-header-right">
      <!-- three-dot menu -->
      <button id="tg-menu-btn" class="tg-icon-btn" aria-label="Menu" title="Menu">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="6" r="1.6" fill="currentColor"/><circle cx="12" cy="12" r="1.6" fill="currentColor"/><circle cx="12" cy="18" r="1.6" fill="currentColor"/></svg>
      </button>
    </div>
  </header>

  <!-- Sticky pin banner (always visible) -->
  <div id="tg-pin-banner" class="tg-pin-banner" role="region" aria-live="polite" aria-label="Pinned message">
    <!-- populated by app.js -->
  </div>

  <!-- Main chat area -->
  <main class="tg-main">
    <div id="tg-comments-wrapper" class="tg-comments-wrapper">
      <div id="tg-comments-container" class="tg-comments-container" aria-live="polite" role="log">
        <!-- Message bubbles appended here by TGRenderer or BubbleRenderer -->
      </div>

      <!-- Jump indicator (scroll-to-bottom) -->
      <button id="tg-jump-indicator" class="tg-jump-indicator hidden" aria-label="Jump to latest">
        <span id="tg-jump-text">New messages</span>
        <span id="tg-jump-count" class="tg-jump-count hidden" aria-hidden="true">0</span>
      </button>
    </div>
  </main>

  <!-- Composer / Input bar -->
  <footer id="tg-composer" class="tg-composer" role="region" aria-label="Message composer">
    <button id="tg-emoji-btn" class="tg-icon-btn tg-emoji-btn" title="Emoji">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.2"/><path d="M8 14s1.2 1.6 4 1.6S16 14 16 14" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><circle cx="9" cy="10" r="0.9" fill="currentColor"/><circle cx="15" cy="10" r="0.9" fill="currentColor"/></svg>
    </button>

    <div class="tg-input-wrap">
      <textarea id="tg-comment-input" class="tg-comment-input" rows="1" placeholder="Message @ProfitHunter" aria-label="Write a message"></textarea>
      <div id="tg-typing-preview" class="tg-typing-preview hidden" aria-hidden="true"></div>
    </div>

    <button id="tg-attach-btn" class="tg-icon-btn tg-attach-btn" title="Attach">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 12v6a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6A3 3 0 0 1 6 3h9" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>

    <!-- round camera/capture CTA that visually sits to the right; when text exists the send arrow will show -->
    <button id="tg-camera-cta" class="tg-camera-cta" title="Camera / Send">
      <svg id="tg-camera-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="3.2" fill="#fff"/><path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0z" stroke="none" opacity="0.06"/></svg>
      <svg id="tg-send-icon" class="hidden" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M22 2L11 13" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 2L15 22l-4-9-9-4 18-7z" stroke="none" fill="#fff" opacity="0.0"/></svg>
    </button>
  </footer>

  <!-- Context menu placeholder -->
  <div id="tg-msg-context" class="tg-msg-context hidden" role="menu" aria-hidden="true"></div>

  <!-- Scripts -->
  <script src="interactions.js" defer></script>
  <script src="joiner-simulator.js" defer></script>
  <script src="realism-engine-v13.js" defer></script>
  <script src="app.js" defer></script>

  <script>
    (function(){
      function initIcons(){ try{ if(window.lucide && typeof window.lucide.createIcons === 'function') window.lucide.createIcons(); }catch(e){} }
      if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initIcons);
      else initIcons();

      // theme: read only, no toggle button (you asked to remove moon)
      try{
        const stored = localStorage.getItem('abrox_theme');
        if(stored) document.documentElement.dataset.theme = stored;
        else if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) document.documentElement.dataset.theme = 'dark';
        else document.documentElement.dataset.theme = 'light';
      }catch(e){ document.documentElement.dataset.theme = 'dark'; }

      // camera CTA toggle logic (simple UI only)
      const input = document.getElementById('tg-comment-input');
      const cam = document.getElementById('tg-camera-cta');
      const cameraIcon = document.getElementById('tg-camera-icon');
      const sendIcon = document.getElementById('tg-send-icon');

      function toggleCameraSend(){
        const hasText = input && input.value && input.value.trim().length > 0;
        if(hasText){
          cameraIcon.classList.add('hidden');
          sendIcon.classList.remove('hidden');
        } else {
          cameraIcon.classList.remove('hidden');
          sendIcon.classList.add('hidden');
        }
      }
      if(input){
        input.addEventListener('input', toggleCameraSend);
        // autosize textarea
        input.addEventListener('input', function(){ this.style.height = 'auto'; this.style.height = (this.scrollHeight) + 'px'; });
        setTimeout(()=>{ if(input) input.style.height = '40px'; }, 50);
      }
      toggleCameraSend();

      // expose debug helpers
      window.UI = window.UI || {};
      Object.assign(window.UI, {
        commentsContainer: document.getElementById('tg-comments-container'),
        pinBanner: document.getElementById('tg-pin-banner'),
        input: document.getElementById('tg-comment-input'),
        cameraCTA: document.getElementById('tg-camera-cta')
      });
    })();
  </script>
</body>
</html>
